<html lang="en" ng-app="BulbsAutocomplete.example">

<head>
  <title>BACON</title>
</head>

<body>

  <div ng-controller="exampleController">
    <h1>{{selectedSuggest.display}}</h1>
    <input type="text" ng-model="searchTerm" ng-change="updateAutocomplete()">
    <bulbs-autocomplete-suggest formatter="suggestFormatter" items="autocompleteItems" on-select="suggestSelect">
    </bulbs-autocomplete-suggest>
    <bulbs-autocomplete-suggest-group-by items="autocompleteItems" formatter="suggestFormatter" grouper="itemGrouper" on-select="groupBySelect">
    </bulbs-autocomplete-suggest-group-by>
  </div>

  <!-- bower:js -->
  <script src="../bower_components/angular/angular.js"></script>
  <script src="../bower_components/lodash/lodash.js"></script>
  <script src="../bower_components/angular-mocks/angular-mocks.js"></script>
  <!-- endbower-->
  <!-- injector:js -->
  <script src="/src/bulbs-autocomplete-suggest/bulbs-autocomplete-suggest-formatter-service.js"></script>
  <script src="/src/bulbs-autocomplete-suggest/bulbs-autocomplete-suggest-group-by/bulbs-autocomplete-suggest-group-by-directive.js"></script>
  <script src="/src/bulbs-autocomplete-suggest/bulbs-autocomplete-suggest-group-by/bulbs-autocomplete-suggest-group-by.js"></script>
  <script src="/src/bulbs-autocomplete-suggest/bulbs-autocomplete-suggest/bulbs-autocomplete-suggest-directive.js"></script>
  <script src="/src/bulbs-autocomplete-suggest/bulbs-autocomplete-suggest/bulbs-autocomplete-suggest.js"></script>
  <script src="/src/bulbs-autocomplete.js"></script>
  <script src="/src/bulbs-autocomplete/bulbs-autocomplete-factory.js"></script>
  <!-- endinjector -->

  <script>
    angular.module('BulbsAutocomplete.example', ['BulbsAutocomplete'])
      .controller('exampleController', function($q, $scope, BulbsAutocomplete) {

        var getItems = function() {
          var defer = $q.defer();

          defer.resolve([{
            name: 'item1',
            value: 10
          }, {
            name: 'item11',
            value: 20
          }, {
            name: 'item21',
            value: 30
          }, {
            name: 'item31',
            value: 40
          }, {
            name: 'item41',
            value: 50
          }, {
            name: 'item51',
            value: 60
          }, {
            name: 'item61',
            value: 70
          }]);
          return defer.promise;
        };

        $scope.suggestFormatter = function(item) {
          return item.name + ' - ' + item.value;
        };

        $scope.suggestSelect = function(item) {
          $scope.selectedSuggest = item;
        };

        $scope.itemGrouper = function(items) {
          return _.groupBy(items, function(item) {
            return item.value > 30 ? 'Less than or equal to thirty': 'More than thirty';
          });
        };

        var autocomplete = new BulbsAutocomplete(getItems);

        $scope.updateAutocomplete = function() {
          autocomplete.$retrieve().then(function(results) {
            $scope.autocompleteItems = results;
          });
        };


      });
  </script>
</body>

</html>
